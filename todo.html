<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Todoist Tasks</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			max-width: 600px;
			margin: auto;
			padding: 20px;
		}
		h1 {
			text-align: center;
		}
		h2 {
			border-bottom: 2px solid #ddd;
			padding-bottom: 5px;
		}
		.task {
			padding: 10px;
			margin: 5px 0;
			border: 1px solid #ddd;
			border-radius: 5px;
		}
		.completed {
			background-color: #f0f0f0;
			text-decoration: line-through;
		}
	</style>
</head>
<body>
	<h1>Todoist Task List</h1>

	<h2>Pending Tasks</h2>
	<div id="pending"></div>

	<h2>Completed Tasks</h2>
	<div id="completed"></div>

	<script>
		fetch("https://landmarklafayette.com/.netlify/functions/getTasks")
			.then(response => response.json())
			.then(tasks => {
				// Sort tasks by date added (most recent first)
				tasks.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

				const pendingDiv = document.getElementById("pending");
				const completedDiv = document.getElementById("completed");

				tasks.forEach(task => {
					const taskElement = document.createElement("div");
					taskElement.classList.add("task");

					let dueDate = task.due ? `Due: ${task.due.string}` : "No due date";
					taskElement.innerHTML = `<strong>${task.content}</strong><br>${task.description || ''}<br><small>${dueDate}</small>`;

					if (task.completed) {
						taskElement.classList.add("completed");
						completedDiv.appendChild(taskElement);
					} else {
						pendingDiv.appendChild(taskElement);
					}
				});
			})
			.catch(error => {
				console.error("Error fetching tasks:", error);
				document.body.innerHTML = "<p>Failed to load tasks.</p>";
			});
	</script>
</body>
</html>
